<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>IrkutskGuessr</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/game.js') }}"></script>
    <script src="https://www.google.com/recaptcha/api.js" async defer></script>
    <script src="https://www.google.com/recaptcha/api.js?onload=initRecaptchas&render=explicit" async defer></script>

</head>
<body>
    <div class="fullscreen-image" id="image-container">
        {% if location %}
            <img src="{{ url_for('static', filename='uploads/' + location.image_filename) }}" alt="{{ location.title }}">
        {% endif %}
    </div>

    <div class="map-corner-container">
        <div class="map-wrapper" id="map-wrapper">
            <div id="map-container"></div>
            <div class="map-overlay"></div>
        </div>
        <div class="buttons-container">
            <button id="guess-btn" disabled>–°–¥–µ–ª–∞—Ç—å –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
            <button id="continue-btn" style="display: none;">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
        </div>
    </div>

    <div class="game-controls"></div>

    <div class="result-overlay" id="result-overlay">
        <table class="result-table">
            <tr>
                <td><span id="comment-cell"></span></td>
                <td><span id="distance-cell"></span> –∫–º</td>
            </tr>
            <tr>
                <td colspan="2" style="text-align: center; font-weight: bold;">–û—á–∫–æ–≤ –Ω–∞–±—Ä–∞–Ω–æ: <span id="points-cell"></span></td>
            </tr>
        </table>
    </div>

    <div class="top-controls-container">
        <div class="top-controls">
            <button id="show-description-btn">üìù</button>
            <button id="explorer-mode-btn">üìç</button>
        </div>
        <div class="top-controls2">
            <button id="set-select-btn">üåê</button>
            <button id="leaderboard-btn">üèÜ</button>
            <button id="set-info-btn">üî•</button>
            <button id="give-up-btn" style="display: none;">üè≥Ô∏è</button>
        </div>
        <div class="top-controls3">
            <button id="settings-btn">‚öôÔ∏è</button>
            <button id="admin-btn">üõ†Ô∏è</button>
            <button id="auth-btn">üë§</button>
        </div>
    </div>

    <div class="overlay" id="description-overlay"></div>

    <div class="description-panel" id="description-panel">
        {% if location %}
            <h3>{{ location.title }}</h3>
            <div class="description-content">
                {{ location.description|safe }}
            </div>
        {% else %}
            <p>–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –¥–ª—è —ç—Ç–æ–π –ª–æ–∫–∞—Ü–∏–∏</p>
        {% endif %}
    </div>

    <div class="settings-overlay" id="settings-overlay" style="display: none;">
        <div class="settings-panel">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
            <div class="setting-item">
                <label>–ö–∞—Ä—Ç–∞:</label>
                <div class="map-provider-buttons">
                    <button class="map-provider-btn active" data-provider="osm">üó∫Ô∏è –û–±—ã—á–Ω–∞—è</button>
                    <button class="map-provider-btn" data-provider="satellite">üõ∞Ô∏è –°–ø—É—Ç–Ω–∏–∫</button>
                    <button class="map-provider-btn" data-provider="dark">üåô –¢–µ–º–Ω–∞—è</button>
                </div>
            </div>
            <div class="setting-item">
                <label for="volume-control">–ì—Ä–æ–º–∫–æ—Å—Ç—å –º—É–∑—ã–∫–∏:</label>
                <input type="range" id="volume-control" min="0" max="100" value="50">
            </div>
            <button class="close-settings-x">‚úï</button>
        </div>
    </div>

    <div class="auth-overlay" id="auth-overlay" style="display: none;">
        <div class="auth-panel">
            <button class="close-auth-x">‚úï</button>
            <div class="auth-tabs">
                <button class="auth-tab" data-tab="register">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                <button class="auth-tab active" data-tab="login">–í—Ö–æ–¥</button>
            </div> 

            <div class="auth-forms-container">
                <div id="register-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="register-email">–ü–æ—á—Ç–∞:</label>
                        <input type="email" id="register-email" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    </div>
                    <div class="auth-form-group">
                        <label for="register-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                        <input type="text" id="register-username" placeholder="–í–∞—à–µ –∏–º—è">
                    </div>
                    <div class="auth-form-group">
                        <label for="register-password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="register-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="auth-form-group">
                        <label for="register-confirm">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="register-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div id="register-recaptcha" class="g-recaptcha"></div>
                    <button id="register-btn">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                </div>

                <div id="login-form" class="auth-form active">
                    <div class="auth-form-group">
                        <label for="login-email">–ü–æ—á—Ç–∞:</label>
                        <input type="email" id="login-email" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    </div>
                    <div class="auth-form-group">
                        <label for="login-password">–ü–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="login-password" placeholder="–í–∞—à –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div id="login-recaptcha" class="g-recaptcha"></div>
                    <button id="login-btn">–í–æ–π—Ç–∏</button>
                    <button class="auth-tab" data-tab="forgot">–ó–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</button>
                </div>
                
                <div id="forgot-form" class="auth-form">
                    <div class="auth-form-group">
                        <label for="forgot-email">–ü–æ—á—Ç–∞:</label>
                        <input type="email" id="forgot-email" placeholder="–í–∞—à–∞ –ø–æ—á—Ç–∞">
                    </div>
                    <button id="forgot-btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥</button>
                </div>

                <div id="forgot-code-group">
                    <div class="auth-form-group">
                        <label for="forgot-code">–ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è:</label>
                        <input type="text" id="forgot-code" placeholder="6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥">
                    </div>
                    <button onclick="verifyResetCode()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∫–æ–¥</button>
                </div>
                    
                <div id="forgot-password-group">
                    <input type="hidden" id="reset-token">
                    <div class="auth-form-group">
                        <label for="new-password">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="new-password" placeholder="–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å">
                    </div>
                    <div class="auth-form-group">
                        <label for="confirm-new-password">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
                        <input type="password" id="confirm-new-password" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    <button onclick="submitNewPassword()">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</button>
                </div>
            </div>
            <div id="auth-status"></div>
        </div>
    </div>

    <div class="settings-overlay" id="set-select-overlay" style="display: none;">
        <div class="settings-panel set-select-panel">
            <h3>–í—ã–±–æ—Ä –Ω–∞–±–æ—Ä–∞</h3>
            
            <!-- –í–µ—Ä—Ö–Ω—è—è —á–∞—Å—Ç—å: –ø–æ–∏—Å–∫ –∏ –≤–≤–æ–¥ –∫–æ–¥–∞ -->
            <div class="set-search-section">
                <div class="setting-item">
                    <input type="text" id="set-search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é">
                </div>
                <div class="setting-item code-input-group">
                    <input type="text" id="set-code-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞–±–æ—Ä–∞">
                    <button id="apply-code-btn">–í–æ–π—Ç–∏ –ø–æ –∫–æ–¥—É</button>
                </div>
            </div>
            
            <!-- –¶–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å: —Å–ø–∏—Å–æ–∫ –Ω–∞–±–æ—Ä–æ–≤ -->
            <div class="public-sets-container">
                <div class="public-sets-scrollable" id="public-sets-list">
                    <!-- –°—é–¥–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –Ω–∞–±–æ—Ä—ã —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
            
            <!-- –ù–∏–∂–Ω—è—è —á–∞—Å—Ç—å: –∫–Ω–æ–ø–∫–∞ –≤—ã–±–æ—Ä–∞ -->
            <div class="set-select-actions">
                <button id="select-set-btn" disabled>–í—ã–±—Ä–∞—Ç—å –Ω–∞–±–æ—Ä</button>
                <button class="close-set-select-x">‚úï</button>
            </div>
        </div>
    </div>

    <div class="set-info-overlay" id="set-info-overlay" style="display: none;">
        <div class="set-info-panel">
            <h3>–°–æ—Ä–µ–≤–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã–π —Ä–µ–∂–∏–º</h3>
            <div class="set-info-content">
                <p>–ú–∞–∫—Å–∏–º—É–º –ø–æ–ø—ã—Ç–æ–∫: <span id="max-attempts">3</span></p>
                <p>–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –ø–æ–ø—ã—Ç–æ–∫: <span id="attempts-count">0</span></p>
                <p>–õ–æ–∫–∞—Ü–∏–π –≤ —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–∏: <span id="locations-count">0</span></p>
            </div>
            <button id="start-competition-btn" style="display: none;">–ù–∞—á–∞—Ç—å —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–µ</button>
            <button class="close-set-info-x">‚úï</button>
        </div>
    </div>

    <div class="leaderboard-overlay" id="leaderboard-overlay" style="display: none;">
        <div class="leaderboard-panel">
            <h3>üèÜ –†–µ–π—Ç–∏–Ω–≥ –Ω–∞–±–æ—Ä–∞</h3>
            <div class="leaderboard-content">
                <table id="leaderboard-table">
                    <thead>
                        <tr>
                            <th>–ú–µ—Å—Ç–æ</th>
                            <th>–ò–º—è</th>
                            <th>–°—á–µ—Ç</th>
                            <th>–í—Ä–µ–º—è</th>
                            <th>–†–µ–π—Ç–∏–Ω–≥</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü–∞ —á–µ—Ä–µ–∑ JS -->
                    </tbody>
                </table>
            </div>
            <button class="close-leaderboard-x">‚úï</button>
        </div>
    </div>


    <div class="auth-overlay" id="user-info-overlay" style="display: none;">
        <div class="auth-panel">
            <button class="close-auth-x">‚úï</button>
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ</h3>
            <div class="user-info-content">
                <p><strong>–ò–º—è</strong> <span id="user-info-username"></span></p>
                <p><strong>–†–æ–ª—å</strong> <span id="user-info-role"></span></p>
                <p><strong>–ü–æ—á—Ç–∞</strong> <span id="user-info-email"></span></p>
            </div>
            <button id="logout-btn" class="auth-btn">–í—ã–π—Ç–∏ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞</button>
        </div>
    </div>

</body>
</html>